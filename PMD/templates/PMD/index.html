{% load staticfiles %}

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>SDO online</title>
		
		<!-- Javascript constants - These constants are generated by django -->
		<script type="text/javascript" charset="utf-8">
			CALENDAR_IMAGE_URL = "{% static 'PMD/images/calendar.png' %}";
			LOADING_IMAGE_URL = "{% static 'PMD/images/loading.gif' %}";
			EXPORT_DATA_REQUEST_TABLE_URL = "{% url 'PMD:user_request_table' 'export_data' %}";
			EXPORT_META_DATA_REQUEST_TABLE_URL = "{% url 'PMD:user_request_table' 'export_meta_data' %}";
			USERNAME = "{{ user.username }}";
		</script>
		
		<!-- Include jquery libraries and plugins -->
		<script src="//code.jquery.com/jquery-1.10.2.js"></script>
		<script src="//code.jquery.com/ui/1.10.4/jquery-ui.js"></script>

		<!-- Include jquery plugins and application javascripts -->
		<script src="{% static 'PMD/js/jquery-ui-timepicker-addon.js' %}" type="text/javascript"></script>
		<script src="{% static 'PMD/js/jquery.cookie.js' %}" type="text/javascript"></script>
		<script src="{% static 'PMD/js/sdo_wizard.js' %}" type="text/javascript"></script>
		
		<!-- Include stylesheets -->
		<link rel="stylesheet" href="{% static 'PMD/css/reset.css' %}" type="text/css">
		<link rel="stylesheet" href="{% static 'PMD/css/jquery-ui-1.10.4.custom.css' %}" type="text/css">
		<link rel="stylesheet" href="{% static 'PMD/css/sdo_wizard.css' %}" type="text/css">
	</head>
<body>

<div id="tabs">
	<!-- Tabs declaration -->
	<ul>
		{% for form in data_series_search_forms %}
		<li><a href="#{{ form.data_series_name }}">{{ form.tab_name }}</a></li>
		{% endfor %}
		{% if user.is_authenticated %}
		<li id="user_tab"><a href="#user"><span class="ui-icon ui-icon-person visual_indicator"></span>{{ user.username }}</a></li>
		{% else %}
		<li id="user_tab"><a href="#user"><span class="ui-icon ui-icon-person visual_indicator"></span>Log in</a></li>
		{% endif %}
	</ul>
	
	<!-- User Tab definition --> 
	<div id="user">
		<!-- If user is not authenticated everything is hidden and will be revealed when logging in -->
		{% if user.is_authenticated %}
		<div id="export_data_request_section" class="section">
		{% else %}
		<div id="export_data_request_section" class="section"  style="display: none;">
		{% endif %}
			<div class="section_title">
				Data export requests
			</div>
			<div class="section_content">
			<span class="ui-icon ui-icon-loading visual_indicator" style="display: inline-block"></span>Loading...
			</div>
		</div>
		{% if user.is_authenticated %}
		<div id="export_meta_data_request_section" class="section">
		{% else %}
		<div id="export_meta_data_request_section" class="section"  style="display: none;">
		{% endif %}
			<div class="section_title">
				Meta-data export requests
			</div>
			<div class="section_content">
			<span class="ui-icon ui-icon-loading visual_indicator" style="display: inline-block"></span>Loading...
			</div>
		</div>
		{% if user.is_authenticated %}
		<div>
		{% else %}
		<div style="display: none;">
		{% endif %}
			<a id="logout" title="Log out of the application" href="{% url 'PMD:logout' %}?next={% url 'PMD:index' %}">Logout</a>
		</div>
		
		
		<!-- If user is not authenticated put a login form -->
		{% if not user.is_authenticated %}
		<form id="login_form" action="{% url 'PMD:login' %}" method="post">
		{% csrf_token %}
			<div class="section login_section">
			<!-- For now we only allow email login, when the LDAP auth is put in place we can uncomment this 
				<div class="section_title">
					Members of ROB, please use your usual username/password
				</div>
				<div class="section_content">
					{{ login_form.as_p }}
				</div>
				<div class="section_title">
					Others, please specify your email address (password is not necessary)
				</div>
				-->
				<div class="section_title">
					Please specify your email address so that we can notify you when your requests are ready.
				</div>
				<div class="section_content">
					{{ email_login_form.as_p }}
				</div>
				<div class="actions">
					<button type="submit" id="login" title="Log in the application">Login</button>
				</div>
			</div>
		</form>
		{% endif %}
	</div>
	
	<!-- Data Series Tab definitions -->
	{% for form in data_series_search_forms %}
	<!-- {{ form.data_series_name }} tab content-->
		<div id="{{ form.data_series_name }}" class="tab_content">
			<!-- {{ form.data_series_name }} search form -->
			<div class="search_panel">
				<form class="data_search_form" action="{% url 'PMD:search_result_table' form.data_series_name %}" method="get">
					<div id="{{ form.data_series_name }}_search_section" class="section specific_search_criteria">
						<div class="section_title">
							Select search criteria
						</div>
						<div class="section_content">
						{{ form.as_p }}
						</div>
						<div class="actions search_actions">
							<button type="submit" class="search_data" title="Search data">Search data</button>
						</div>
					</div>
				</form>
			</div>
			<!-- {{ form.data_series_name }} search results -->
			<div class="search_result_panel">
				<div class="section search_result_section">
					<div class="section_title">
						<span class="ui-icon visual_indicator"></span>
						Search results
					</div>
					<div class="section_content">
						&#8592; Please make a search for data on the left.
					</div>
					<div class="actions search_result_actions">
						<form action="{% url 'PMD:search_result_action' 'download_bundle' form.data_series_name %}" method="post">
							{% csrf_token %}
							<button class="download_bundle" title="Download the selected data as a zip file">Download data</button>
						</form>
						<form action="{% url 'PMD:search_result_action' 'export_data' form.data_series_name %}" method="post">
							{% csrf_token %}
							<button class="export_data" title="Export the selected data for download">Export data</button>
						</form>
						<form action="{% url 'PMD:search_result_action' 'export_meta_data' form.data_series_name %}" method="post">
							{% csrf_token %}
							<button class="export_meta_data" title="Export the selected meta-data to a csv file">Export keywords</button>
						</form>
						<form action="{% url 'PMD:search_result_action' 'export_cutout' form.data_series_name %}" method="post">
							{% csrf_token %}
							<button class="export_cutout" title="Download a cutout of the selected data">Export cutout</button>
						</form>
					</div>
				</div>
			</div>
		</div>
	{% endfor %}
</div>



